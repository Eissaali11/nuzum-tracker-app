# ๐ ุดุฑุญ ุชูุตููู: ุณุจุจ ุนุฏู ุฅุฑุณุงู/ุนุฑุถ ุตูุฑ ุงููุญุต ูู ุชูุงุตูู ุงูุณูุงุฑุฉ

## ๐ ููุฎุต ุงููุดููุฉ

ุตูุฑ ุงููุญุต **ูุง ุชุธูุฑ** ูู ุตูุญุฉ ุชูุงุตูู ุงูุณูุงุฑุฉ (`car_details_screen.dart`) ูุฃู ุงูููุฏ ุงูุญุงูู **ูุง ูุฌูุจ ููุง ูุนุฑุถ** ุทูุจุงุช ุงููุญุต ุงููุฑุชุจุทุฉ ุจุงูุณูุงุฑุฉ.

---

## ๐ ููู ูุนูู ุงููุธุงู ุญุงููุงู

### 1๏ธโฃ **ุฑูุน ุตูุฑ ุงููุญุต**
- ุนูุฏ ุฑูุน ุตูุฑ ุงููุญุตุ ูุชู ุฅูุดุงุก **ุทูุจ ูุญุต** (Car Inspection Request)
- ุงูุทูุจ ูุชู ุฅูุดุงุคู ุนุจุฑ: `POST /api/v1/requests/create-car-inspection`
- ูู ุทูุจ ูุญุชูู ุนูู:
  - `vehicle_id`: ูุนุฑู ุงูุณูุงุฑุฉ
  - `inspection_type`: ููุน ุงููุญุต
  - `media`: ุงูุตูุฑ ูุงูููุฏูููุงุช ุงููุฑููุนุฉ

### 2๏ธโฃ **ุชุฎุฒูู ุงูุจูุงูุงุช**
- ุตูุฑ ุงููุญุต **ููุณุช ุฌุฒุกุงู ูุจุงุดุฑุงู** ูู ุจูุงูุงุช ุงูุณูุงุฑุฉ
- ุงูุตูุฑ ูุฑุชุจุทุฉ ุจู **ุทูุจุงุช ุงููุญุต** (Requests)
- ูู ุทูุจ ูุญุต ูู `vehicle_id` ูุฑุจุทู ุจุงูุณูุงุฑุฉ

### 3๏ธโฃ **ุฌูุจ ุจูุงูุงุช ุงูุณูุงุฑุฉ**
ูู ููู `lib/screens/car_details_screen.dart`:
- ูุชู ุฌูุจ ุจูุงูุงุช ุงูุณูุงุฑุฉ ุนุจุฑ `getVehicleDetailsWithHandovers()`
- **ููู ูุง ูุชู ุฌูุจ ุทูุจุงุช ุงููุญุต** ุงููุฑุชุจุทุฉ ุจุงูุณูุงุฑุฉ
- ุงููุชูุฌุฉ: ุงูุตูุญุฉ ุชุนุฑุถ ูุนูููุงุช ุงูุณูุงุฑุฉ ููุทุ ุจุฏูู ุตูุฑ ุงููุญุต

---

## โ ุงููุดุงูู ุงูููุฌูุฏุฉ ูู ุงูููุฏ

### ุงููุดููุฉ 1: ุนุฏู ุฌูุจ ุทูุจุงุช ุงููุญุต

**ุงููููุน:** `lib/screens/car_details_screen.dart` - ุฏุงูุฉ `_loadCarDetails()`

**ุงูููุฏ ุงูุญุงูู:**
```dart
final vehicleDetailsResponse = await EmployeeApiService.getVehicleDetailsWithHandovers(
  employeeId: employeeId,
  vehicleId: widget.car.carId,
);
```

**ูุง ูููุต:**
- ูุง ูุชู ุงุณุชุฏุนุงุก `RequestsApiService.getCarInspectionRequests(vehicleId: ...)`
- ูุง ูุชู ุฌูุจ ุทูุจุงุช ุงููุญุต ุงููุฑุชุจุทุฉ ุจุงูุณูุงุฑุฉ

---

### ุงููุดููุฉ 2: ุนุฏู ุนุฑุถ ุตูุฑ ุงููุญุต

**ุงููููุน:** `lib/screens/car_details_screen.dart` - ุฏุงูุฉ `build()`

**ุงูููุฏ ุงูุญุงูู ูุนุฑุถ:**
- โ ูุนูููุงุช ุงูุณูุงุฑุฉ ุงูุฃุณุงุณูุฉ
- โ ุตูุฑุฉ ุงูุงุณุชูุงุฑุฉ (`registrationFormImage`)
- โ ุงูุชูุงุฑูุฎ ุงููููุฉ
- โ ุณุฌูุงุช ุงูุชุณููู/ุงูุงุณุชูุงู
- โ ุฒุฑ ูุฑูุน ุตูุฑ ุงููุญุต (`_buildInspectionUploadButton`)
- โ **ูุง ููุฌุฏ ูุณู ูุนุฑุถ ุตูุฑ ุงููุญุต ุงููุฑููุนุฉ ูุณุจูุงู**

---

### ุงููุดููุฉ 3: ูููุฐุฌ ุงูุณูุงุฑุฉ ูุง ูุญุชูู ุนูู ุตูุฑ ุงููุญุต

**ุงููููุน:** `lib/models/car_model.dart`

**ุงูุญููู ุงูููุฌูุฏุฉ:**
```dart
final String? registrationImage; // ุตูุฑุฉ ุงูุงุณุชูุงุฑุฉ
final String? registrationFormImage; // ุตูุฑุฉ ูููุฐุฌ ุงูุงุณุชูุงุฑุฉ
// โ ูุง ููุฌุฏ ุญูู ูุตูุฑ ุงููุญุต
```

**ุงูุณุจุจ:**
- ุตูุฑ ุงููุญุต ููุณุช ุฌุฒุกุงู ูู ุจูุงูุงุช ุงูุณูุงุฑุฉ ูุจุงุดุฑุฉ
- ุงูุตูุฑ ูุฑุชุจุทุฉ ุจุทูุจุงุช ุงููุญุต (Requests)
- ูุฌุจ ุฌูุจูุง ูููุตูุฉ ุนุจุฑ API ุงูุทูุจุงุช

---

## ๐ง ุงูุญู ุงููุทููุจ

### ุงูุฎุทูุฉ 1: ุฌูุจ ุทูุจุงุช ุงููุญุต

ูู `_loadCarDetails()` ูุฌุจ ุฅุถุงูุฉ:

```dart
// ุฌูุจ ุทูุจุงุช ุงููุญุต ุงููุฑุชุจุทุฉ ุจุงูุณูุงุฑุฉ
final inspectionRequestsResult = await RequestsApiService.getCarInspectionRequests(
  vehicleId: int.parse(widget.car.carId),
  status: null, // ุฌูุจ ุฌููุน ุงูุทูุจุงุช ุจุบุถ ุงููุธุฑ ุนู ุงูุญุงูุฉ
);

if (inspectionRequestsResult['success'] == true) {
  final inspectionRequests = inspectionRequestsResult['data'] as List;
  // ุญูุธ ุงูุทูุจุงุช ูู state
  setState(() {
    _inspectionRequests = inspectionRequests;
  });
}
```

---

### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ูุณู ูุนุฑุถ ุตูุฑ ุงููุญุต

ูู `build()` ูุฌุจ ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ ุจุนุฏ ุฒุฑ ุฑูุน ุงูุตูุฑ:

```dart
// ูุณู ุตูุฑ ุงููุญุต ุงููุฑููุนุฉ
if (_inspectionRequests.isNotEmpty) ...[
  const SizedBox(height: 20),
  _buildSectionHeader('ุตูุฑ ุงููุญุต ุงููุฑููุนุฉ', Icons.photo_library_rounded),
  const SizedBox(height: 12),
  ..._inspectionRequests.map((request) => _buildInspectionRequestCard(request)),
],
```

---

### ุงูุฎุทูุฉ 3: ุจูุงุก ุจุทุงูุฉ ุทูุจ ุงููุญุต

ุฅุถุงูุฉ ุฏุงูุฉ ุฌุฏูุฏุฉ ูุนุฑุถ ูู ุทูุจ ูุญุต ูุน ุตูุฑู:

```dart
Widget _buildInspectionRequestCard(Map<String, dynamic> request) {
  final media = request['media'] as List<dynamic>? ?? [];
  final inspectionType = request['inspection_type'] ?? 'unknown';
  final inspectionDate = request['inspection_date'] ?? '';
  
  return Container(
    // ุชุตููู ุงูุจุทุงูุฉ
    child: Column(
      children: [
        // ูุนูููุงุช ุงูุทูุจ
        Text('ููุน ุงููุญุต: $inspectionType'),
        Text('ุงูุชุงุฑูุฎ: $inspectionDate'),
        
        // ุนุฑุถ ุงูุตูุฑ
        if (media.isNotEmpty)
          GridView.builder(
            // ุนุฑุถ ุงูุตูุฑ ูู grid
            itemCount: media.length,
            itemBuilder: (context, index) {
              final imageUrl = media[index]['url'];
              return Image.network(imageUrl);
            },
          ),
      ],
    ),
  );
}
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. **API Endpoint ุงููุชุงุญ**
- โ `GET /api/v1/requests/car-inspection?vehicle_id={id}` - ููุฌูุฏ ููุนูู
- โ ูููู ููุชุฑุฉ ุงูุทูุจุงุช ุญุณุจ `vehicle_id`

### 2. **ูููู ุงูุจูุงูุงุช ุงููุชููุน**
ุนูุฏ ุฌูุจ ุทูุจุงุช ุงููุญุตุ ุงูู API ูุฑุฌุน:
```json
{
  "success": true,
  "requests": [
    {
      "id": 123,
      "vehicle_id": 456,
      "inspection_type": "periodic",
      "inspection_date": "2024-01-15",
      "media": [
        {
          "id": 1,
          "url": "https://...",
          "type": "image"
        }
      ]
    }
  ]
}
```

### 3. **ุงูุฃุฏุงุก**
- ูุฏ ูููู ููุงู ุนุฏุฉ ุทูุจุงุช ูุญุต ููู ุณูุงุฑุฉ
- ูุฌุจ ุงุณุชุฎุฏุงู pagination ุฅุฐุง ูุงู ุนุฏุฏ ุงูุทูุจุงุช ูุจูุฑุงู
- ูููู ุนุฑุถ ุขุฎุฑ 5-10 ุทูุจุงุช ููุท

---

## โ ุงูุฎูุงุตุฉ

**ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:**
- ุตูุญุฉ ุชูุงุตูู ุงูุณูุงุฑุฉ **ูุง ุชุฌูุจ** ุทูุจุงุช ุงููุญุต ุงููุฑุชุจุทุฉ ุจุงูุณูุงุฑุฉ
- ุญุชู ูู ุชู ุงูุฌูุจุ **ูุง ููุฌุฏ UI** ูุนุฑุถ ุงูุตูุฑ

**ุงูุญู:**
1. ุฅุถุงูุฉ ุงุณุชุฏุนุงุก `getCarInspectionRequests()` ูู `_loadCarDetails()`
2. ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ ูู `build()` ูุนุฑุถ ุทูุจุงุช ุงููุญุต
3. ุจูุงุก ุจุทุงูุงุช ูุนุฑุถ ูู ุทูุจ ูุน ุตูุฑู

**ุงููููุงุช ุงูุชู ุชุญุชุงุฌ ุชุนุฏูู:**
- `lib/screens/car_details_screen.dart` - ุฅุถุงูุฉ ุฌูุจ ูุนุฑุถ ุทูุจุงุช ุงููุญุต

---

## ๐ ุงููุฑุงุฌุน

- **API Endpoint:** `GET /api/v1/requests/car-inspection?vehicle_id={id}`
- **Service Method:** `RequestsApiService.getCarInspectionRequests()`
- **File Location:** `lib/services/requests_api_service.dart` - ุงูุณุทุฑ 2199

2						3204 - NSB	AL JAZIRAH	Nissan  -  Urvan	Aramex Courier		
